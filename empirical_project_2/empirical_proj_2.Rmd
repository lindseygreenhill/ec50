---
title: "empirical_proj_2"
author: "Lindsey Greenhill"
date: "4/9/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(haven)
library(rdrobust)
library(statar)
library(vtable)
library(ggthemes)
library(sandwich)
library(ggpubr)
library(lmtest)

data <- read_dta("third_grade.dta")
```

## Question 1

The fundamental problem of causal inference is that you cannot see the outcome
for a child who both was in a small class and not in a small class. In other
words, it is impossible to measure the dual outcomes when a child both is in a
small class and not in a small class, because the child can only either be in a
small class or not in a small class.

## Question 2

The following variables have missing values:

- towncode: 318 missing
- math: 58 missing
- verb: 466 missing
- ses_index: 318 missing
- boy: 1037 missing

```{r echo=FALSE}
summary(data)
```

## Questions 3 and 4

```{r echo=FALSE, results = "asis"}

# getting the means

math_mean <- mean(data$math, na.rm = T)
verb_mean <- mean(data$verb, na.rm = T)

# getting the sds

math_sd <- sd(data$math, na.rm = T)
verb_sd <- sd(data$verb, na.rm = T)

# standardizing

data$math_std <- (data$math - math_mean) / math_sd
data$verbal_std <- (data$verb - verb_mean) / verb_sd

# creating test score index

data <- data %>%
  mutate(test_score_index = .5 * (math_std + verbal_std)) %>%
  mutate(math_miss = if_else(is.na(math),
                             1,
                             0),
         verb_miss = if_else(is.na(verb),
                                1,
                                0)) %>%
  mutate(test_score_index = if_else(is.na(test_score_index),
                                    if_else(math_miss == 1, verbal_std, math_std),
                                    test_score_index))


# summary table

sumtable(data,
         vars = c("math", "verb", "test_score_index"),
         summ = c("mean(x)",
                  "sd(x)",
                  "min(x)",
                  "max(x)"),
         out = "latex")

```

## Question 5

All of the histograms appear to not by symmetrical and all of them have a long
left tail.

```{r echo=FALSE, warning = FALSE}

# math hist

hist_math <- data %>%
  ggplot(aes(x = math,
             y = ..density..)) +
  geom_histogram(binwidth = 1) +
  labs(title = "Distribution of Math Scores") +
  theme_clean()


# verbal hist

hist_verb <- data %>%
  ggplot(aes(x = verb,
             y = ..density..)) +
  geom_histogram(binwidth = 1) +
  labs(title = "Distribution of Verbal Scores") +
  theme_clean()

# index hist

hist_index <- data %>%
  ggplot(aes(x = test_score_index,
             y = ..density..)) +
  geom_histogram(binwidth = .25) +
  labs(title = "Distribution of Test Score Index") +
  theme_clean()

ggarrange(hist_math,
          hist_verb,
          hist_index)

```

## Question 6

```{r echo=FALSE, warning = FALSE}

# creating binned scatter plots

bin_index_ses <- data %>%
  ggplot(aes(x = ses_index, y = test_score_index)) +
  stat_binmean(n = 20, geom = "point") +
  labs(title = "Test Score Index vs. SES Index") +
  theme_classic()

bin_class_ses <- data %>%
  ggplot(aes(x = ses_index, y = class_size)) +
  stat_binmean(n = 20, geom = "point") +
  labs(title = "Class Size vs. SES Index") +
  theme_classic()
  
bin_index_class <- data %>%
  ggplot(aes(x = class_size, y = test_score_index)) +
  stat_binmean(n = 20, geom = "point") +
  labs(title = "Test Score Index vs. Class Size") +
  theme_classic()

ggarrange(bin_index_ses,
          bin_class_ses,
          bin_index_class)

```

## Question 7

As we can see from the binned scatter plots above, the socio economic
index variable is correlated with both class size and test score index.
As such, it is a counfounding variable and mean we cannot interpret 
the relationship between class size and test scores causally because
it is likely that a student's socioeconomic status influences both 
outcomes, meaning that we don't know how greatly class size affects
test scores versus ses affects test scores.

## Question 8

```{r echo=FALSE}

narrow <- data %>%
  filter(school_enrollment <= 80)
```




