---
title: "week_4_lab"
author: "Lindsey Greenhill"
date: "2/23/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(haven)
library(ggthemes)
library(stargazer)
library(gt)

star <- read_dta("star.dta")
```

## Question 1
  
  It is important to randomize the teachers in addition to the students because
  there could be reasons why one teacher is more likely to teach a small class
  or a big class, and any of those reasons could act as confounding variables
  in our analysis. 

## Question 2

```{r echo=FALSE}
star %>%
  group_by(small) %>%
  summarise(avg_class = mean(class_size, na.rm = T)) %>%
  gt()

```


The average class sizes are shown in the table above. As expected, class sizes
are smaller in the classes assigned to be small than in the classes assigned
to be large. 

## Question 3

```{r}

# I will go back and make this into a function if I have time

# math

# calculating control meaan and sd

control_mean_m <- star %>%
  filter(small == 0) %>%
  summarise(mean = mean(math, na.rm=T)) %>%
  as.double()
control_sd_m <- star %>%
  filter(small == 0) %>%
  summarise(sd = sd(math, na.rm=T)) %>%
  as.double()

# creating a new col

star <- star %>%
  mutate(standard_math = (math - control_mean_m)/control_sd_m)

# repeating steps above

# read

control_mean_r <- star %>%
  filter(small == 0) %>%
  summarise(mean = mean(read, na.rm=T)) %>%
  as.double()
control_sd_r <- star %>%
  filter(small == 0) %>%
  summarise(sd = sd(read, na.rm=T)) %>%
  as.double()
star <- star %>%
  mutate(standard_read = (read - control_mean_r)/control_sd_r)

# wordskill

control_mean_s <- star %>%
  filter(small == 0) %>%
  summarise(mean = mean(wordskill, na.rm=T)) %>%
  as.double()
control_sd_s <- star %>%
  filter(small == 0) %>%
  summarise(sd = sd(wordskill, na.rm=T)) %>%
  as.double()
star <- star %>%
  mutate(standard_wordskill = 
           (wordskill - control_mean_s)/control_sd_s)

# listen

control_mean_l <- star %>%
  filter(small == 0) %>%
  summarise(mean = mean(listen, na.rm=T)) %>%
  as.double()
control_sd_l <- star %>%
  filter(small == 0) %>%
  summarise(sd = sd(listen, na.rm=T)) %>%
  as.double()
star <- star %>%
  mutate(standard_listen = (listen - control_mean_l)/control_sd_l)

# calculating sat_index. for some reason mean function isn't working

star_new <- star %>%
  mutate(sat_index = (standard_math + standard_read + 
                        standard_wordskill + standard_listen)/4)

# plotting a histogram

star_new %>%
  ggplot(aes(x = sat_index, y = ..density..)) +
  geom_histogram(bins = 30) +
  facet_wrap(~small) +
  theme_clean() +
  labs(title = "Distribution of sat_index by class size")

```

The histograms look very similar to each other. 

\newpage

## Question 4

```{r echo=FALSE}

# creating new dataframe by class

by_teacher <- star_new %>%
  group_by(teacher_id, small, school_id, teacher_masters, teacher_white,
         teacher_black, teacher_experience) %>%
  summarise(avg_index = mean(sat_index, na.rm = T))

# creating regression for small

mod_1 <- lm(teacher_experience ~ small, data = by_teacher)

summary(mod_1)

# creating regression for teacher_masters

mod_2 <- lm(teacher_masters ~ small, data = by_teacher)

summary(mod_2)

# creating regression for teacher_white

mod_3 <- lm(teacher_white ~ small, data = by_teacher)

summary(mod_3)

# teacher_black regression

mod_4 <- lm(teacher_black ~ small, data = by_teacher)

summary(mod_4)
```


- teacher_experience: The standard error for the small coefficient = .6649. 
1.96 x .6649 = 1.303. The resulting 95% confidence interval 
of the coefficient = -.4107 +/- 1.303. Or [-.8923, 1.7137].

- teacher_masters: The standard error for the small coefficient = .05426.
1.96 x .05426 = .1063. The resulting 95% confidence interval for the coefficient
= -.0408 +/- .1063. Or [-.1471, .06554]

- teacher_white: the small standard error = .04174. The small coefficient =
.04291. The 95% confidence interval = .04291 +/- 1.96*.04174 or [-.0389,.1247]

- teacher_black: the small standard error = .04143. The small coefficient = -.03786. 
The 95% CI = -.0376 +/- 1.96*.04143 or [-.119,.0433]

- The differences in teacher characteristics in small vs. large class sizes are
not statistically significant for any of the characteristics we looked at above.
This means that statistically the randomization was successful in balancing
teacher characteristics. From the practical standard, the values for
teacher_experience do not seem practically significant because they refer to a
difference of about 1 year which doesn't seem like a lot. The teacher masters
seems to bit more practically significant, as the lower bound of the confidence
interval implies about a 15% difference between the two groups of teachers. Both
the teacher_white and teacher_black results also seem a bit practically
significant because the greatest bounds of the confidence intervals suggest a
12.5%  and 11.9% difference in groups, respectively. However, overall these
differences do not seem overly troubliing to me and I think we still have 
comparable teacher groups. 

